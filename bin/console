#!/usr/bin/env node
var repl = require('repl');

var env = process.env.NODE_ENV || 'development';
var dbconf = require('../config/database')[env];
var Sequelize = require('sequelize');
var _ = Sequelize.Utils._;

//TODO: fix config/database to absolute path
if (dbconf.dialect === 'sqlite') {
  dbconf.storage = '../' + dbconf.storage;
}
var sequelize = new Sequelize(dbconf);

/**
 * insert models to global
 */
var models = require('../server/models');
_(models).each((model, key) => {
  global[key] = new model(sequelize, Sequelize);
});

/**
 * create API client
 */
global.client = new (require('./lib/api-client'))('localhost', 3000);

/**
 * show info
 */
console.log(`ENV    : ${env}`);
console.log(`DB     : ${JSON.stringify(dbconf)}`);

var modelName = [];
_(models).each((models, key) => modelName.push(key));
console.log(`MODEL  : [${modelName.join(', ')}]`);
console.log(`CLIENT : ${global.client.getHost()}, ${global.client.getPort()}`);
console.log('-----');

var replServer = repl.start({ prompt: 'loq> ' });
